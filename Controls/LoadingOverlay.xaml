<UserControl x:Class="Reports.Controls.LoadingOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             x:Name="Root"
             IsHitTestVisible="{Binding IsBlocking, ElementName=Root}">

    <UserControl.Resources>
        <Storyboard x:Key="ShowStoryboard">
            <DoubleAnimation Storyboard.TargetName="OverlayRoot"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.12"/>
            <DoubleAnimation Storyboard.TargetName="CardScale"
                             Storyboard.TargetProperty="ScaleX"
                             From="0.97" To="1" Duration="0:0:0.16"/>
            <DoubleAnimation Storyboard.TargetName="CardScale"
                             Storyboard.TargetProperty="ScaleY"
                             From="0.97" To="1" Duration="0:0:0.16"/>
        </Storyboard>

        <Storyboard x:Key="HideStoryboard">
            <DoubleAnimation Storyboard.TargetName="OverlayRoot"
                             Storyboard.TargetProperty="Opacity"
                             From="1" To="0" Duration="0:0:0.14"/>
            <DoubleAnimation Storyboard.TargetName="CardScale"
                             Storyboard.TargetProperty="ScaleX"
                             From="1" To="0.98" Duration="0:0:0.14"/>
            <DoubleAnimation Storyboard.TargetName="CardScale"
                             Storyboard.TargetProperty="ScaleY"
                             From="1" To="0.98" Duration="0:0:0.14"/>
        </Storyboard>
    </UserControl.Resources>

    <!-- Root overlay -->
    <Grid x:Name="OverlayRoot"
          Visibility="Collapsed"
          Opacity="0"
          Background="{Binding OverlayBackground, ElementName=Root}"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          Panel.ZIndex="999">

        <Border x:Name="Card"
                CornerRadius="10"
                Padding="20"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                Opacity="0.98"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                SnapsToDevicePixels="True"
                RenderTransformOrigin="0.5,0.5">

            <Border.RenderTransform>
                <ScaleTransform x:Name="CardScale" ScaleX="0.97" ScaleY="0.97"/>
            </Border.RenderTransform>

            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Width="280">
                <ui:ProgressRing Width="40"
                                 Height="40"
                                 IsIndeterminate="True"
                                 Margin="0,0,0,12"/>

                <ui:TextBlock Text="{Binding Message, ElementName=Root}"
                              HorizontalAlignment="Center"
                              FontSize="14"
                              TextAlignment="Center"
                              TextWrapping="Wrap"/>

                <ui:TextBlock Text="{Binding Detail, ElementName=Root}"
                              Margin="0,6,0,0"
                              Opacity="0.75"
                              HorizontalAlignment="Center"
                              FontSize="12"
                              TextAlignment="Center"
                              TextWrapping="Wrap"
                              Visibility="{Binding HasDetailVisibility, ElementName=Root}"/>

                <ui:Button x:Name="CancelButton"
                           Margin="0,14,0,0"
                           Appearance="Secondary"
                           Content="{Binding CancelText, ElementName=Root}"
                           Click="Cancel_Click"
                           Visibility="{Binding CancelVisibility, ElementName=Root}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
